
export DOCKER_REPO_PREFIX=victory-sokolov


# Helper functions

function docker-clean() # stops and cleans all docker containers & images
{
        docker stop $(docker ps -a -q)
        docker rm $(docker ps -a -q)
}

function dms() # docker-machine start
{
    machine_name="$@"
    docker-machine start $machine_name
    docker-machine env $machine_name
    eval "$(docker-machine env $machine_name)"
}

function drmnone() # remove untagged images
{
	docker rmi -f $(docker images -f "dangling=true" -q)
}


function docker-compose-watch() # watch and reload docker
{
  local args;
  if [[ $1 == "help" ]] || [[ $1 = "--help" ]]; then
    watchexec --help | grep -A 3 "OPTIONS:";
    return;
  else
    args='--filter "*/docker-compose.yml"' && [[ $1 ]] && args=$@;
  fi
  eval watchexec --restart $args -w $(pwd) "docker-compose up"
}


function di() # Get container id by name
{
	docker ps -aqf "name=$1"
}

function dcs() # Stop container by name
{
	docker container stop $(docker container ls -q --filter name=$1*)
}

function docker-stop # Stop all containers
{
    docker stop $(docker container ls -q)
}


# Docker containers aliases and functions
alias splash="docker run --rm --name scrapy-splash -d -p 8050:8050 scrapinghub/splash"
alias docker-compose-reload=docker-compose-watch;
